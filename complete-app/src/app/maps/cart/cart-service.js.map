{"version":3,"sources":["cart/cart-service.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;YAQA;gBAQI,qBAAY,WAAwB;oBANpC,SAAI,GAAQ,EAAG,CAAC;oBAEhB,gBAAW,GAAQ,EAAE,CAAC;oBAKlB,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;gBACnC,CAAC;gBAED,yBAAG,GAAH,UAAI,OAAO;oBAEP,IAAI,IAAI,GAAG,IAAI,CAAC;oBAEhB,cAAc,OAAO;wBAEjB,IAAI,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,WAAW,EAAE,CAAC;wBACjD,EAAE,CAAA,CAAC,OAAO,CAAC,QAAQ,IAAI,WAAW,CAAC,EAAE,CAAC,CAAC,CAAC;4BACpC,MAAM,EAAE,OAAO,EAAE,kCAAkC,EAAE,CAAC;wBAC1D,CAAC;wBAED,IAAI,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,UAAS,CAAC,IAAI,MAAM,CAAC,CAAC,CAAC,EAAE,IAAI,OAAO,CAAC,EAAE,CAAC,CAAC,CAAC,CAAE,CAAC;wBACzE,EAAE,CAAA,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;4BACd,MAAM,EAAE,OAAO,EAAE,OAAO,CAAC,IAAI,GAAG,2BAA2B,EAAE,CAAC;wBAClE,CAAC;wBAED,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;wBAExB,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,UAAS,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;oBACnD,CAAC;oBAED,MAAM,CAAC,IAAI,OAAO,CAAC,UAAS,OAAO,EAAE,MAAM;wBAEvC,IAAI,CAAC;4BACD,IAAI,CAAC,OAAO,CAAC,CAAC;4BACd,OAAO,EAAE,CAAC;wBACd,CAAE;wBAAA,KAAK,CAAA,CAAC,CAAC,CAAC,CAAC,CAAC;4BACR,MAAM,CAAC,CAAC,CAAC,CAAC;wBACd,CAAC;oBAEL,CAAC,CAAC,CAAC;gBAGP,CAAC;gBAED,4BAAM,GAAN,UAAO,OAAO;oBACV,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,EAAC,UAAS,CAAC,IAAI,MAAM,CAAC,CAAC,CAAC,EAAE,IAAI,OAAO,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC/D,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,UAAS,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;gBAEnD,CAAC;gBAED,2BAAK,GAAL;oBACI,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;gBACrB,CAAC;gBAED,+BAAS,GAAT;oBACI,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC;gBAC5B,CAAC;gBAED,gCAAU,GAAV;oBACI,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAC,UAAS,CAAC,IAAI,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBACnE,CAAC;gBAED,+BAAS,GAAT,UAAU,EAAE;oBACR,IAAI,CAAC,WAAW,GAAG,CAAE,EAAE,CAAE,CAAC;gBAC9B,CAAC;gBApEL;oBAAC,iBAAU,EAAE;;+BAAA;gBAsEb,kBAAC;YAAD,CArEA,AAqEC,IAAA;YArED,qCAqEC,CAAA","file":"cart/cart-service.js","sourcesContent":["\nimport {RestService} from \"../util/rest-service\";\nimport {UserService} from \"../user/user-service\";\nimport {Injectable} from \"angular2/core\";\n\ndeclare var _:any;\n\n@Injectable()\nexport class CartService  {\n\n    cart: any = [ ];\n\n    subscribers: any = [];\n\n    userService: UserService;\n\n    constructor(userService: UserService) {\n        this.userService = userService;\n    }\n\n    add(monster) {\n\n        var self = this;\n\n        function _add(monster) {\n\n            var currentUser = self.userService.currentUser();\n            if(monster.sellerId == currentUser.id) {\n                throw { message: \"You can not buy your own monster\" };\n            }\n\n            var f = _.filter(self.cart, function(m) { return m.id == monster.id; } );\n            if(f.length > 0) {\n                throw { message: monster.name + \" is already in your cart.\" };\n            }\n\n            self.cart.push(monster);\n\n            self.subscribers.forEach(function(s) { s(); });\n        }\n\n        return new Promise(function(resolve, reject) {\n\n            try {\n                _add(monster);\n                resolve();\n            } catch(e) {\n                reject(e);\n            }\n\n        });\n\n\n    }\n\n    remove(monster) {\n        _.remove(this.cart,function(m) { return m.id == monster.id; });\n        this.subscribers.forEach(function(s) { s(); });\n\n    }\n\n    items() {\n        return this.cart;\n    }\n\n    itemCount() {\n        return this.cart.length;\n    }\n\n    totalPrice() {\n        return _.sum(_.map(this.cart,function(m) { return m.price; }));\n    }\n\n    subscribe(fn) {\n        this.subscribers = [ fn ];\n    }\n\n}"],"sourceRoot":"/source/"}